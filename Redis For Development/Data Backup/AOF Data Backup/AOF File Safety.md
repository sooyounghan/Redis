-----
### AOF 파일의 안전성
-----
1. 시점 단위로 데이터를 저장하는 RDB 방식보다 명령어 단위로 로그를 저장하는 AOF 방식이 안전함
2. 운영체제에서 시스템 콜을 이용해 데이터를 파일에 저장하는 방법
<div align="center">
<img src="https://github.com/user-attachments/assets/3f11b352-9054-45c5-9c27-15563b3cdf50">
</div>

3. 운영체제에서 애플리케이션이 파일에 데이터를 저장하고자 할 때, 곧바로 디스크에 저장되지 않음
   - WRITE라는 시스템 콜을 이용해 애플리케이션에서 파일에 데이터를 저장하겠다 하면 데이터는 커널 영역의 OS 버퍼에 임시로 저장
   - 운영체제가 판단하게 커널이 여유 있거나, 최대 지연 시간인 30초에 도달하면 커널 버퍼의 데이터를 실제 디스크에 내려씀
   - FSYNC는 커널의 OS 버퍼에 저장된 내용을 실제로 디스크에 내리도록 강제하는 시스템 콜
     + OS에 부하가 있더라도 FSYNC가 호출되면 데이터는 무조건 디스크에 플러시

 4. 레디스에서 AOF 파일을 저장할 때 APPENDSYNC 옵션을 이용하면 FSYNC 호출을 제어할 수 있으며, 즉, 파일 저장의 내구성을 제어할 수 있음
    - APPENDSYNC no : AOF 데이터를 저장할 때 WRITE 시스템 콜을 호출
      + 데이터는 커널 영역에 데이터가 잘 저장되는지만 확인하므로 쓰기 성능이 가장 빠름

    - APPENDSYNC always : AOF 데이터를 저장할 때 항상 WRITE와 FSYNC 시스템 콜을 함께 호출
      + 즉, 매번 쓰고자 하는 데이터가 파일에 정확하게 저장되는 것을 기다리므로 쓰기 성능이 가장 느림

    - APPENDSYNC everysec : 데이터를 저장할 때 WRITE 시스템 콜을 호출하며, 1초에 한 번씩 FSYNC 시스템 콜을 호출
      + 성능은 no 옵션을 사용했을 때와 거의 비슷

    - 기본 옵션은 everysec로, no 옵션을 사용할 때와 비슷한 성능을 가지며, 서버에 장애가 발생했을 때 유실될 수 있는 데이터는 최대 1초이므로 속도와 안정성의 균형을 맞출 수 있는 값
    - 이 값을 always로 설정한 경우 데이터는 굉장히 느려질 수 있으며, no로 설정할 경우 서버에 장애가 발생하면 최대 30초 동안 레디스가 입력했던 데이터를 잃을 수 있음
    - 따라서, 일반적인 everysec 옵션을 사용하는 것 권장
    
