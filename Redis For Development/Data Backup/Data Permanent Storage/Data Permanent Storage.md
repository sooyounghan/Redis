-----
### 레디스에서 데이터를 영구 저장하기
-----
1. 레디스에서 모든 데이터는 메모리에서 관리
2. 따라서 레디스 인스턴스 혹은 레디스가 실행되는 서버의 장애로 인해 레디스 인스턴스가 재시작할 경우 메모리에 상주해있던 레디스의 모든 데이터는 손실될 가능성이 있음
3. 레디스를 복제 구조로 사용할 경우 데이터가 실시간으로 복제본에 전달되고 있으니, 따로 데이터를 백업할 필요를 느끼지 못할 수 있음
4. 백업과 복제는 목적부터 다름
   - 복제 : 가용성을 위한 것
   - 백업 : 장애 상황에서 데이터의 복구를 위해 필요
   - 만약, 개발자의 실수 혹은 프로그램 상 버그로 인해 마스터 노드에서 의도하지 않은 데이터를 삭제하는 커맨드가 실행되면 이는 바로 복제본에 전달
     + 따라서, 복제 구조만으로 데이터를 안전하게 유지할 수 없음

5. 레디스를 캐시가 아닌 영구 저장소와 같은 용도로 사용한다면 디스크에 데이터를 주기적으로 백업하는 것이 안전
6. 데이터를 안전하게 저장하기 위해 레디스에서는 RDB와 AOF 두 가지 백업 방식 지원
   - AOF (Append Only File) : 레디스 인스턴스가 처리한 모든 쓰기 작업을 차례대로 기록, 복원 시에는 파일을 다시 읽어가며 데이터 세트 재구성
   - RDB (Redis Database) : 일정 시점에 메모리에 저장된 데이터 전체를 저장 (Snapshot 방식)
   - 예시
```redis
> SET key1 a
OK

> SET key1 apple
OK

> SET key2 b
OK

> DEL key2
(integer) 1
```
   - key1이라는 키에 a라는 값을 저장한 뒤 다시 apple을 저장
   - a라는 값은 없어지고 apple로 덮어 씌워짐
   - key2에는 b를 저장한 뒤 DEL 커맨드를 이용해 키 삭제
<div align="center">
<img src="https://github.com/user-attachments/assets/1ef38dcd-8575-4373-bbb9-c06678e82286">
</div>

   - RDB 파일은 바이너리 형태로 저장되어 우리가 읽고 해석할 수 없는 형태
   - AOF 파일은 레디스 프로토콜(RESP) 형태로 저장

7. AOF 파일에는 레디스에서 실행된 모든 쓰기 작업이 기록
   - key1 데이터가 다른 값으로 변경된 내역, key2가 생성됐다가 삭제된 내역 모두 AOF 파일에 기록
   - 따라서, AOF 파일을 처음부터 끝까지 따라가면 원본 데이터에 도달할 수 있음

8. RDB 파일은 저장되는 시점의 메모리 데이터가 그대로 저장
   - 사진을 찍듯 메모리의 데이터를 그대로 내려쓰므로 스냅샷 방식이라고도 함
   - 위 예시의 커맨드를 모두 실행한 뒤 RDB 파일을 생성한다면, RDB 파일에는 실제로 메모리에 작성된 값인 key1의 값이 apple이라는 데이터만 남게 됨

9. 두 방식 모두 장단점이 존재
    - RDB 파일 : 시점 단위로 여러 백업본을 저장할 수 있고, AOF 파일보다 복원이 빠르지만, 특정 시점으로 복구 불가능
    - AOF 파일 : RDB 파일보다 크기가 크고 주기적으로 압축해 재작성해야 하지만, 원하는 시점으로 복구할 수 있음

10. 하나의 인스턴스에서 RDB와 AOF 옵션을 동시에 사용하는 것도 가능하며, 일반적인 RDB만큼의 데이터 안정성을 원하는 경우 두 가지 백업 방식을 동시에 사용하는 것을 권장
     - 데이터를 복원할 때 AOF 파일이 존재한다면 레디스는 더 안전하다고 판단되는 AOF 파일을 복원 시 사용
     - 데이터 안정성을 위해서는 주기적인 RDB 스냅샷을 갖는 것이 좋기 때문임

11. 레디스에서는 데이터를 복원할 수 있는 시점은 서버가 재시작 될 때 뿐이며, 레디스 인스턴스 실행 도중 데이터 파일을 읽어올 수 있는 방법은 없음
    - 레디스 서버는 재시작 될 때 AOF 파일이나 RDB 파일이 존재하는지 확인한 뒤, 파일이 있을 때 파일 로드
    - 레디스는 RDB 파일보다 AOF 파일이 더 내구성이 보장된다고 판단하므로, 2개의 파일이 모두 존재할 때는 AOF의 데이터를 로드
