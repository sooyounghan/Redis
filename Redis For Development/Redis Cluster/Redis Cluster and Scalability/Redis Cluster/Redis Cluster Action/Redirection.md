-----
### 리다이렉션
-----
1. 💡 레디스 클리스터가 반환하는 리다이렉션 : MOVED 리다이렉션과 ASK 두 가지 종류
   - MOVED 리다이렉션 : 클라이언트에게 요청하는 해시슬롯이 저 노드에 있으니 앞으로 이 키에 대한 요청은 저 노드로 보내라는 것을 의미
   - ASK 리다이렉션 : 지금 요청한 이 쿼리는 저 노드에서 수행하지만, 다음 노드는 다시 나한테 보내라는 의미

2. 실시간 트래픽이 많은 서비스에서는 속도가 굉장히 중요할 수 있으며, 다른 노드에 커넥션을 다시 한 번 맺는 과정이 많아졌을 때, 절대 무시할 수 없는 속도 차이를 발생시킬 수 있으므로 레디스에서 리다이렉션을 구분해 구현
3. MOVE 리다이렉션
   - 레디스 노드는 클라이언트가 보낸 커맨드가 단일 키 커맨드인지, 다중 키인 경우 언급된 여러 키가 모두 동일한 해시슬롯에 있는지 파악한 뒤, 키가 속한 해시슬롯을 포함한 마스터 노드를 찾음
   - 만약, 해당 커맨드를 받은 노드가 그 해시슬롯을을 가지고 있을 경우 : 원하는 데이터를 해시슬롯에서 바로 찾아 반환 가능
   - 아니라면, 어떤 노드가 해시슬롯을 갖고 있는지 해시슬롯 맵을 확인한 후 MOVED 에러로 클라이언트에게 응답
```redis
GET x
-MOVED 2345 192.168.0.22:6379
```
   - MODVED 에러는 키의 해시슬롯(2345)과 해당 해시슬롯을 갖고 있는 마스터 노드 정보 (```192.168.0.22:6379```)를 반환
   - 클라이언트는 반환받은 노드의 IP와 포트로 다시 커맨드를 수행해 데이터 조회
   - 이 때, 클라이언트는 해시슬롯 2345가 ```192.168.0.22:6379``` 노드에 존재함을 기억
   - 이후, 애플리케이션에서 이 키를 다시 조회하려고 할 경우, 클라이언트에서 바로 올바른 마스터 노드로 데이터를 조회할 수 있어 리다이렉션 과정을 생략함으로써 시간 단축 가능
   - 클러스터가 안정적일 때 모든 클라이언트는 해시슬롯, 노드의 맵을 가지고 있으며, 이 때 올바른 노드를 직접 찾아갈 수 있어 SPOF가 없는 효율적 서비스 사용 가능

4. ASK 리다이렉션
   - 해시슬롯이 이동되는 과정에서만 발생
   - 이 리다이렉션을 받은 클라이언트의 동작
     + 리다이렉션 오류가 반환한 노드 정보로 쿼리를 재전송하지만, 이후에 같은 키에 대한 쿼리가 들어오면 기존에 전송한 노드에 다시 보냄
     + 리아디렉션을 받은 값으로 클라이언트 해시슬롯 맵의 값을 업데이트 하지 않음
   - A가 갖고 있던 해시슬롯 8을 B로 옮기는 과정
<div align="center">
<img src="https://github.com/user-attachments/assets/aa6579ef-c8e9-4c90-b8ac-7129a6e5ff82">
</div>

   - 해시슬롯을 옮기는 도중 클라이언트가 해시슬롯 8에 포함된 키인 user:1을 조회하려 함
   - 만약 클라이언트 B 노드에 이 키 값을 요청한다면, B는 리다이렉션 요청을 보내는데, 이 때 MOVED가 아닌 ASK 요청을 보냄
   - 마이그레이션 과정이 완료되면, 8번 해시슬롯은 B로 이동될 예정이므로, 그 후의 요청은 B로 전송해야 함

   - 마이그레이션이 완료된 이후의 그림
<div align="center">
<img src="https://github.com/user-attachments/assets/7db419c8-b43d-49c8-96da-a481fd2efa7d">
</div>

   - 레디스는 ASK 리다이렉션을 사용해 연결을 A로 단 한 번만 전환
   - 클라이언트의 맵이 업데이트 되지 않아서, user:1을 조회하면 커맨드는 바로 B로 연결
<div align="center">
<img src="https://github.com/user-attachments/assets/6d0f689e-e10f-46c6-85bd-77097d6ca00a">
</div>

   - 만약 마이그레이션이 완료된 뒤 다른 클라이언트가 A에 user:1에 대한 커맨드를 수행하면, MOVED 리다이렉션을 이용
   - 해시슬롯을 소유하고 있는 노드가 완전히 B로 변경되었으므로, 해시슬롯 맵을 업데이트 해 다음 연결이 지속적으로 B로 이뤄지게 하는 것이 적절
     
