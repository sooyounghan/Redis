-----
### 클러스터 라이브 재구성
-----
1. 클러스터가 정상적으로 운영되는 동안 새로운 마스터 노드를 추가하거나 기존 마스터 노드 제거 가능
   - 클러스터에서 노드를 추가하고 삭제하는 작업은 동일한 작업으로 여겨질 수 있음
   - 클러스터에 새로운 노드를 추가하려면 빈 노드를 클러스터에 추가한 뒤, 일부 해시 슬롯을 기존 마스터에서 신규 노드로 옮김
   - 클러스터에서 노드를 제거하려면 해당 노드를 빈 노드로 만들기 위해, 갖고 있던 해시슬롯을 다른 노드로 보냄

2. 두 작업 모두 결국 하나의 노드 내에서 해시슬롯을 다른 노드로 옮기는 작업이 동반
   - 사실 해시슬롯 또한 결국 논리적인 키의 집합이므로 레디스 클러스터가 실제로 하는 일은 하나의 마스터 노드에서 다른 마스터 노드로 데이터를 올기는 것을 의미
   - A가 갖고 있는 해시 슬롯 8을 B로 옮기고 싶다면, 각 노드에서 다음 커맨드 수행
     + A에게 : CLUSTER SETSLOT 8 MIGRATING B
     + B에게 : CLUSTER SETSLOT 8 MIGRATING A

   - 위 커맨드가 실행 중인 상태에서 노드 A가 해시슬롯 8에 대한 쿼리를 받았을 때, 만약 기존에 존재하던 키를 읽는 쿼리라면 A에서 수행
   - 반대로 해시슬롯 8에 새로운 키를 생성하는 쿼리를 받았다면 이 쿼리는 B 노드로 리다이렉션
   - 따라서, 더 이상 A에서 해시슬롯 8에 대한 새로운 키를 만들지 않게 됨
   - 또한, 레디스는 해시슬롯 8에 속한 키를 A에서 B로 마이그레이션

3. 커맨드
```redis
CLUSTER GETKEYINSLOT lost count
```

   - 이 커맨드는 지정한 해시슬롯이 가지고 있는 키를 반환
   - 반환된 모든 키에 대해 노드 A에 MIGRATE 커맨드를 전송
   - 다음 커맨드는 키를 원자적으로 A에서 B로 마이그레이션
     + 2개의 인스턴스 모두 키를 마이그레이션 하는 동안 락이 걸리며, 이로 인한 경쟁 상황은 발생하지 않음
```redis
MIGRATE target-host target-port key target-database id timeout
```
   - MIGRATE는 대상 인스턴스에 연결해 키를 전송
   - OK 코드를 받으면 기존 데이터셋에서 키 삭제
   - 외부 클라이언트에서 봤을 때, 키는 양 쪽에 존재할 수 없으며, A 또는 B 둘 중 하나에 존재
   - 마이그레이션 프로세스가 완료되면 두 노드에게 모두 ```SETSLOT <slot> NODE <node-id>``` 커맨드를 전송 : 이 커맨드는 다른 모든 노드로 전파
