-----
### 하트비트 패킷
-----
1. 레디스 클러스터 노드들은 지속적으로 서로 상태를 확인하기 위해 PING, PONG 패킷을 주고 받음 : 이 두 패킷을 묶어서 하트비트(Heartbeat) 패킷이라 함
   - 일반적으로 클러스터가 주고받는 유형의 패킷에 가십 섹션이 추가된 형태
<div align="center">
<img src="https://github.com/user-attachments/assets/2fdb3446-187f-4f95-9684-68759f4925ed">
</div>

2. 일반적으로 사용하는 패킷의 헤더 정보
   - 노드 ID
   - 현재 에포크 / 구성 에포크 : 분산 환경에서 일관성을 유지하기 위한 정보
   - 노드 플래그 : 노드가 마스터인지 혹은 복제본인지 등의 노드 정보
   - 비트맵 : 마스터가 제공하는 해시슬롯의 비트맵 정보 (복제본인 경우 마스터 정보)
   - TCP 포트 : 발신 노드의 TCP 포트
   - 클러스터 포트 : 발신 노드의 노드 간 커뮤니케이션을 위한 포트
   - 클러스터 상태 : 발신 노드 관점에서 봤을 때 클러스터 상태 (Down / OK)
   - 마스터 노드 ID : 복제본 노드인 경우 마스터 노드 ID

3. 하트비트 패킷의 경우 위의 헤더에 가십 섹션을 추가로 포함
   - 이 섹션은 패킷을 발신하는 노드가 알고 있는 클러스터 내 다른 노드 정보를 나타냄
   - 발신자 노드는 자신이 알고 있는 노드 중 랜덤한 몇 개의 노드만 가십 섹션에 포함
   - 하트비트 패킷을 받은 클러스터 노드는 다른 노드에 대한 정보를 얻을 수 있음
   - 이를 이용해 알지 못하던 다른 노드를 받아들일 수 있으며, 장애도 감지할 수 있게 됨

4. 센티널에서와 비슷하게 분산 환경에서 노드 간 구성의 정합성을 유지하기 위해 레디스 클러스터는 에포크(Epoch)라는 개념 사용
   - 에포크는 클러스터에서 여러 이벤트의 순서를 나타내는 값
   - 0부터 시작해 1씩 증분하며, 레디스 클러스터에서의 논리적 클락이라고 볼 수 있음
   - 분산 환경에서 각 노드는 에포크 값을 가지며, 이 값이 클수록 최신 구성을 갖고 있는 노드라는 것을 의미

5. 클러스터를 생성할 떄 모든 노드의 현재 에포크 값은 0
   - 다른 노드들과 통신을 하며 패킷에 들어 있는 에포크 값을 확인하게 되는데, 이 때 수신받은 패킷의 에포크 값이 로컬 노드의 값보다 크다면, 현재 에포크 값을 송신한 노드의 에포크 값으로 업데이트
   - 모든 노드는 끊임없이 PING / PONG을 주고 받기 때문에, 결국 모든 노드는 클러스터에서 가장 큰 구성 에포크 값으로 통일
   - 이 값은 클러스터 상태를 변경할 떄와 페일오버가 발생할 때 동의를 구하기 위해 사용
