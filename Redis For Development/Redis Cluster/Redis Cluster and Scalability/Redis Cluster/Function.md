-----
### 레디스 클러스터의 기능
-----
1. 레디스를 클러스터 모드로 사용하면 추가적 애플리케이션 아키텍쳐 변경 없이 여러 레디스 인스턴스 간 수평 확장이 가능해짐
   - 또한, 데이터의 분산 처리와 복제, 자동 페일오버 기능 또한 사용 가능

2. 데이터 샤딩
   - 데이터 저장소를 수평 확장하며 여러 서버 간 데이터를 분할하는 데이터베이스 아키텍쳐 패턴을 샤딩이라 함
<div align="center">
<img src="https://github.com/user-attachments/assets/1275c35c-c9f0-4dd5-aa64-97890180021a">
</div>

   - 레디스에서 클러스터 기능을 사용하면 마스터를 최대 1,000개 까지 확장시킬 수 있음
   - 데이터의 샤딩과 관련된 모든 기능은 레디스 내부에서 자체적으로 관리되며, 이를 위한 프록시 서버 등 추가 아키텍쳐가 필요하지 않음
   - 클러스터에서 데이터는 키를 이용해 샤딩되며, 키는 항상 하나의 마스터 노드에 매핑
     + 클러스터의 모든 노드는 키가 저장되어야 할 노드를 알고 있으므로 클라이언트가 다른 노드에 데이터를 쓰거나 읽으려 할 때, 키가 할당된 마스터 노드로 연결을 리다이렉션함
     + 이 과정은 레디스 노드와 애플리케이션 쪽 레디스 클라이언트에서 처리
     + 데이터를 분할 저장할 때, 애플리케이션의 소스 코드 로직이 변경될 필요가 없으므로, 샤딩 처리에 들어가는 번거로움을 줄일 수 있다는 장점 존재

   - 클러스터에서 노드가 추가 / 변경되지 않는 이상 하나의 키는 특정 마스터에 매핑
     + 매번 레디스에 키를 저장할 노드를 질의하지 않게 하기 위해 클라이언트에서 클러스터 내 특정 키가 어떤 마스터에 저장되어 있는지 정보를 캐싱할 수 있으므로, 이를 이용해 키를 찾아오는 시간을 단축할 수 있음

3. 고가용성
<div align="center">
<img src="https://github.com/user-attachments/assets/43248579-dd15-4af1-8087-d66c361763ff">
</div>

   - 클러스터는 각각 최소 3대의 마스터, 복제본 노드를 갖도록 구성하는 것이 일반적
   - 하나의 클러스터 구성에 속한 각 노드는 서로를 모니터링
   - 마스터 노드에 장애가 발생하면 이를 인지한 다른 노드들이 마스터에 연결되었던 다른 노드들이 마스터에 연결되었던 복제본 노드를 마스터로 자동 페일오버시키므로 사용자의 추가적인 개입 없이 레디스의 가용성을 증가시킬 수 있음
   - 또한, 마스터에 연결된 복제본 개수를 파악해 잉여 복제본을 필요하 노드에 연결시키는 복제본 마이그레이션 작업을 수행하기도 함
   - 이 때, 클러스터의 노드들은 클러스터 버스라는 독립적 통신 이용
     + 모든 레디스 클러스터 노드는 다른 레디스 클러스터 노드에서 들어오는 연결을 수신하기 위해 추가 TCP 포트가 열려 있음
     + 클라이언트로부터 커맨드를 받는 TCP 포트와 독립하게 동작하며, 구성 파일에서 cluster_bus_port 값을 정의하지 않는다면, 일반 포트에 10000을 더한 값으로 자동 설정
     + 즉, 레디스 노드가 6379 포트로 띄워졌다면, 버스 포트는 16379 포트를 이용해 통신

   - 클러스터는 모든 노드가 TCP 연결을 사용해 다른 모든 노드와 연결되어있는 풀 매쉬(Full-Mesh) 토폴리지 형태
     + 클러스터가 N개의 노드로 이루어져 있을 때, 모든 노드는 N - 1개의 다른 노드와 송수신 TCP 연결을 하고 있으며, 이 연결은 계속 유지
     + 1개 노드에서 다른 노드로 PING을 보냈을 때, PONG 응답이 늦는다면 해당 노드로의 연결을 새로 시도

   - 풀 매쉬 토폴리지 형태로 구성된 레디스 클러스터 구조이지만, 노드 간 너무 많은 메세지를 교환하는 오버헤드는 걱정하지 않아도 됨
     + 가십 프로토콜과 구성 업데이트 메커니즘을 이용해 클러스터가 정상적인 상태에서는 노드 간 너무 많은 메세지를 교환하지 않음
     + 노드가 증가하더라도 메세지가 기하급수적으로 늘어나지는 않도록 설계
     
