-----
### redis-cli를 이용해 클러스터 접근하기와 리다렉션
-----
1. 레디스 클러스터에 접속하기 위해서는 클러스터 모드를 지원하는 레디스 클라이언트가 필요
   - 클러스터 모드를 지원하는 클라이언트만이 리다이렉션 등의 기능을 제공하고, 이 기능을 이용해야 클러스터를 제대로 사용할 수 있음
   - redis-cli도 레디스를 접속하기 위한 클라이언트 중 하나

2. 일반적인 레디스 노드에 접속하는 것처럼 redis-cli를 이용해 레디스에 접속한 뒤 데이터 하나 저장 (```192.168.0.11``` 서버에서 다음 커맨드 수행)
```redis
$ redis-cli
127.0.0.1:6379> SET user:1 true
(error) MOVED 10778 192.168.0.22:6379
```
<div align="center">
<img src="https://github.com/user-attachments/assets/0e07a7b7-40c7-4b2c-bdd9-e21dd3afc507">
</div>

   - ```192.168.0.11``` IP의 노드에 연결해서 user:1이라는 키를 입력하려 시도했으나, 해당 키가 들어가야 할 해시슬롯은 10778이며, 그 해시슬롯을 가지고 있는 레디스는 IP가 ```192.168.0.22```인 마스터 노드라는 응답
   - 즉, 일반적인 클라이언트를 이용해 데이터를 넣을 때에는 데이터가 저장될 수 있는 노드가 정해져 있고, 해당 노드에만 키에 대한 커맨드를 수행시킬 수 있음을 의미

3. 이러한 불편함을 줄이기 위해 Jedis, Redisson 등의 레디스 클라이언트들은 클러스터 모드 제공
   - redis-cli를 사용한다면 -c 옵션을 추가해 클러스터 모드를 사용할 수 있고, 이 경우 리다이렉션 기능 제공
   - ```192.168.0.11``` 서버에서 -c 옵션을 사용해 레디스에 접속한 뒤, 위와 동일하게 user:1이라는 키 저장
```redis
$ redis-cli -c
127.0.0.1:6379> SET user:1 true
-> Redirected to slot [10778] located at 192.168.0.22:6379
OK
192.168.0.22:6379>
```
   - 데이터를 저장하자 Redirected 되었다는 메세지가 뜬 뒤, 데이터가 정상적으로 저장되어 OK 응답을 받음
   - 그 뒤, 연결 IP는 로컬을 의미하는 주소인 ```127.0.0.1```에서 실제 데이터가 저장된 노드인 ```192.168.0.22```로 변경
   - 즉, redis-cli라는 클라이언트가 연결을 ```192.168.0.11```에서 저장하고자 하는 키가 있는 ```192.168.0.22```로 자동으로 옮겼다는 것을 의미
<div align="center">
<img src="https://github.com/user-attachments/assets/673458c6-1417-4e5c-b5b2-1dd6f4f9cc29">
</div>

   - 동일하게 MOVED라는 응답을 받은 클라이언트는 반환받은 에러를 바로 사용자에게 전달하지 않고, 변경된 노드로 직접 연결을 변경한 뒤 올바른 레디스 노드에서 커맨드 다시 수행
   - 대부분 레디스 클라이언트는 이렇게 리다이렉션한 정보를 캐싱해 맵을 생성하게 되는데, 다음 번 같은 키에 대해 커맨드를 수행해야 할 경우 에러를 반환해서 커넥션을 옮겨가는 과정을 거치지 않고, 캐싱된 노드로 바로 커맨드를 보낼 수 있게 해 클러스터의 성능을 향상시킬 수 있게 됨
   - 클러스터에 저장된 맵은 마스터 노드가 추가 / 삭제 되거나, 페일오버가 발생하는 등 클러스터 구조가 변경되면 리프레쉬 됨
