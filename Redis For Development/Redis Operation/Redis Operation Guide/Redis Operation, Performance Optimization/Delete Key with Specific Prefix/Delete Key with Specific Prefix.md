-----
### 특정 프리픽스 키를 가진 키 삭제
-----
1. 레디스에서는 특정 프리픽스를 기반으로 키를 삭제하는 기능을 기본으로 제공하지 않음
2. 하지만 일반적으로 특정 프리픽스를 사용해 키를 구분하는 경우가 많으며, 때로는 특정 프리픽스를 가진 키를 일괄적으로 삭제해야 할 상황이 발생하기도 함
   - 잘못된 배포로 인해 특정 프리픽스를 가진 모든 키를 제거해야 할 때나, 일정 기간 이후 데이터를 정리해야 하는 경우 존재
   - 메모리 사용량을 관리하기 위해 불필요한 데이터를 삭제해야 할 때도, 프리픽스를 기준으로 삭제해야 할 데이터를 구분할 수 있음
   - 하지만 삭제 작업은 마스터 인스턴스에서만 수행할 수 있으므로, 운영 중인 서비스에 영향을 미치지 않도록 주의 깊게 실행해야 하는 조심스러운 작업
     + 삭제를 빠르고 확실하게 수행하는 방법도 존재하지만, 운영 중인 레디스에 최소한 영향을 미치면서 데이터를 삭제하는 방법
     + 보통 프리픽스를 가진 키를 한 번에 삭제할 수 없으므로 다음과 같은 방법 사용
<div align="center">
<img src="https://github.com/user-attachments/assets/45937c50-c6f8-4bef-87c5-3efbfa7cc10d">
</div>

   - 코드에서는 pattern 변수에 prefix:*와 같은 패턴을 설정하며, prefix:로 시작하는 모든 키를 검색하라는 의미
   - while 루프를 사용해 SCAN 명령을 여러 번 실행
     + SCAN 명령은 한 번에 모든 키를 반환하지 않고, 커서 값을 업데이트하면서 페이지 단위로 키를 반환하며, 커서 값이 0이 될때까지 계속해서 키를 검색

   - 이후 keys 리스트에 저장된 모든 키를 순회하면서 레디스에서 키를 삭제
   - 이렇게 함으로써 특정 프리픽스를 가진 모든 데이터를 레디스에서 삭제 가능

   - 동작 방식
<div align="center">
<img src="https://github.com/user-attachments/assets/96728923-2d46-4176-b454-933af455fabf">
</div>

   - 레디스에 1000만 개의 키가 있고, 매치하는 패턴이 100만개 있다면 SCAN 작업 이후에 레디스에 100만 번의 추가 접근이 필요해 데이터를 삭제하는 작업은 상당히 시간이 오래 걸리는 작업이 됨
   - 각 키를 하나씩 삭제하기 위해 왕복 시간 소요

3. 이 때, 루아 스크립트를 이용하면 네트워크 I/O를 줄이면서 같은 작업을 효율적 수행 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/9c4b73d4-cb90-487d-93d0-1246ddb9455e">
</div>

   - 동작 방식
<div align="center">
<img src="https://github.com/user-attachments/assets/4ebc89aa-0808-4012-b97a-0301b784a736">
</div>

   - 루아 스크립트를 사용하는 방법에는 레디스로 매번 DEL 명령을 호출하는 과정 생략
   - 기존에는 A와 B가 반복되는 횟수만큼 네트워크 왕복 시간은 소요되지만, 루아 스크립트를 사용한 방법은 A 횟수만큼 네트워크 왕복 시간이 소요됨
   - 주의사항
     + 스크립트가 실행되는 동안 다른 클라이언트 커맨드는 차단될 수 있음
     + 따라서, 운영 환경에서 데이터를 삭제해야 한다면, 서비스와 데이터 특성을 파악하고 다른 클라이언트에게 영향을 미치지 않는 적절한 배치 크기로 count 매개변수를 조절해 차단 시간을 최소화해야함
     + 예시의 코드에서는 배치 사이즈를 1000으로 설정했고, 한 번의 SCAN 커맨드 결과로 최대 1000개의 키가 반환될 수 있음

4. 레디스에서 SCAN으로 키를 검색하고 DEL로 삭제하는 시간은 굉장히 짧은
   - 레디스를 사용할 때 주로 고려해야 할 부분은 네트워크 통신 시간으로, 네트워크 통신을 최적화하는 방법을 개발하면 레디스를 활용하는 과정에서 발생하는 지연 시간을 단축시키고 전반적 성능을 향상시킬 수 있음


