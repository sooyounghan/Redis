-----
### DAU 구하기
-----
1. DAU (Daily Active User) : 하루 동안 서비스에 방문한 사용자의 수
   - 하루에 여러번 방문했다 하더라도 한 번으로 카운팅되는 값으로, 실제 서비스를 이용한 사용자의 유니크한 수를 파악할 수 있는 지표
   - 이 수치는 사용자의 동향을 파악하고, 마케팅을 위한 자료로 활용되기도 함

2. 애플리케이션의 사용자 접근 로그와 같은 접속 로그를 활용해 날마다 배치 처리를 수행하는 방식으로 DAU를 계산할 수 있지만, 이런 방식으로는 실시간 데이터를 확인할 수 없음
3. DAU는 유저 ID를 set에 저장하는 방법을 고려해볼 수 있음
   - 하지만, 하루 1000만 명 이상 유저가 방문하는 큰 서비스라면, 이럴 경우 하나의 키 안에 너무 많은 아이템이 저장될 수 있으며, 이는 곧 성능의 저하로 이어짐
   - 보통 키 하나당 저장하는 아이템은 최대 200~300만개까지로 조정할 것을 권장
   - 또한, 저장되는 데이터가 많을 수록 메모리를 많이 차지하게 됨

4. 레디스의 비트맵을 이용하면 메모리를 효율적으로 줄이면서도 실시간으로 서비스의 DAU 확인 가능
   - 레디스에서 비트맵은 별개의 자료구조로 존재하는 것은 아니며, string 자료 구조에 bit 연산을 할 수 있도록 구현
   - 이용자 수가 1천만명이 넘는 게임 서비스에서 레디스의 bit를 이용해 DAU를 측정하는 방법
     + 이 때, 사용자의 ID는 0 이상의 정숫값이어야 함
     + 사용자 ID는 string 자료 구조에서 하나의 비트로 표현 가능 : 그렇기에 1천만명의 사용자는 1천만개의 비트로 나타낼 수 있으며, 이는 대략 1.2MB 크기에 해당
     + 레디스에서 string의 최대 길이는 512MB이므로, 하나의 키를 사용해 1천만 명의 사용자를 카운팅하는 것은 문제없이 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/90331119-b1e6-4382-8f33-b84fc5d45fe4">
</div>

   - 2022년 11월 6일 방문한 유저 ID를 구하기 위해서 키가 uv:20221106인 데이터를 만든 뒤, 접속한 유저 ID의 bit를 1로 설정
   - ID가 14인 유저가 접근했을 때는 오프셋 14를 1로 설정
   - 해당 일자에 접근한 유저 수를 확인할 때는 BITCOUNT 커맨드 사용
```redis
> SETBIT uv:20221106 14 1
(integer) 0

> BITCOUNT uv:20221106
(integer) 1
```

5. 비트맵에서 BITOP 커맨드를 사용하면 AND, OR, XOR, NOT 연산을 할 수 있으며, 레디스 서버에서 바로 게산된 결과를 가져올 수 있어 개별 비트를 가져와 서버에서 처리하는 번거로움을 줄여줄 수 있음
   - 게임에서 출석 이벤트를 진행하기 위해 특정 기간 동안 매일 방문한 사용자를 구하고 싶을 경우 : 11월 1일부터 3일까지 매일 출석한 유저에게 보상을 지급하기 위해 일주일 동안 매일 출석한 유저를 구하는 방법
<div align="center">
<img src="https://github.com/user-attachments/assets/8ec902dc-cbe5-4613-90c6-e99932c2dc55">
</div>

   - BITOP AND 커맨드를 이용하면 3일 동안 연속 출석한 유저의 정보를 새로운 비트맵 자료 구조인 event:202211로 얻을 수 있음
```redis
> BITOP AND event:202211 uv:20221101 uv:20221102 uv:20221103
(integer) 2
```

   - 비트맵 데이터는 응용쪽 애플리케이션에서 list로 변환해 사용 가능하며, 위 이벤트의 결과 데이터인 event:202211 확인
```redis
> GET event:202211
"\x01\0x2"
```
  - 비트맵은 사실상 string 자료 구조로 저장되므로 GET 커맨드를 사용해 저장된 데이터 확인 가능
    + 파이썬을 이용해 문자열을 리스트로 변환하는 코드
<div align="center">
<img src="https://github.com/user-attachments/assets/49bc2054-dc5b-4638-9e5c-6ca9f0603d45">
</div>

  - 위 예제에서 event:202211 키에 저장된 값을 결과 변수인 results에 저장한 후, 이 변수를 문자 단위로 순회하면서 비트 연산 수행
  - 각 문자를 이진 비트로 변환하고, 모든 비트를 왼쪽에서 오른쪽으로 순회하면서 비트의 값 추출
  - 추출된 비트 값을 사용해 리스트를 생성해 bistlist에 저장하는 작업 진행
