-----
### 클라이언트 핸들링
-----
1. 레디스는 클라이언트 연결을 수락하는데 TCP 포트와 유닉스 소켓을 사용할 수 있음
   - 일반적으로 사용자 연결을 받기 위해 TCP 포트를 사용하지만, 설정 파일에서 unixsocket 및 unixsocketperm 매개변수를 설정하면 원하는 경로에 소켓 파일을 생성하고 해당 파일의 권한을 지정 가능
```redis
unixsocket /tmp/redis.sock
unixsocketperm 777
```

2. 이렇게 설정한 뒤 레디스를 시작하면 원하는 경로에 파일이 생성되며, 소켓 통신 활성화
   - 이후에는 클라이언트가 해당 유닉스 소켓 파일의 경로를 사용해 레디스 서버에 연결
```redis
redis-cli -s /tmp/redis.sock
```

3. 레디스는 멀티플렉싱(Multiplexing) 방식을 사용하며, 이로 인해 하나의 통신 채널을 통해 여러 데이터 스트림을 전송할 수 있음
   - 하나의 스레드에서 여러 소켓을 감시하고, 소켓 이벤트가 발생하는지 지속적 확인할 수 있기 때문에 효율적인 다중 클라이언트 지원을 가능하게 하고, 많은 클라이언트 요청을 동시에 처리하는데 블로킹 문제를 피할 수 있음

4. 또한 논블로킹 I/O(Non-blocking I/O)를 활용해 I/O 작업이 완료될 때까지 대기하지 않고, 다른 작업을 처리할 수 있어서, 클라이언트 요청을 비동기적으로 처리하고 다수의 클라이언트 요청을 동시에 처리할 수 있음
5. 레디스는 클라이언트 커넥션을 생성할 때 TCP_NODELAY 옵션을 사용하는데, 이 옵션을 설정하면 소켓은 작은 데이터라도 버퍼링하지 않고 지연 없이 가능한 한 빨리 패킷으로 전송하려고 시도
   - 이는 주로 작은 데이터 조각을 실시간으로 전송해야 하는 경우에 사용되며, 이로 인해 클라이언트 연결 지연을 최소화할 수 있음
   - 이 설정은 레디스 소스 코드에서 확인 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/5a2404f9-a596-4e1c-aefa-e206c43c8676">
</div>

6. 레디스 버전 7을 기준을, 레디스와 클라이언트가 통신할 때 TCP_NODELAY 옵션은 해제 불가
   - 하지만 레디스 노드 간 복제 연결할 때에는 다음 설정 값을 변경해 TCP_NODELAY 옵션 해제 가능
```redis
repl-disabled-tcp-nodelay yes
```
   - 해당 설정값을 yes로 설정하면, 레디스는 복제본에 데이터를 전송할 때 더 작은 수의 TCP 패킷과 대역폭을 사용
   - 그러나 데이터가 복제본에서 나타나기까지 약 40ms의 지연이 발생할 수 있음
   - 해당 설정을 no로 하면, 마스터와 복제본 간 데이터 지연을 최소화하여 데이터를 복제본에서 좀 더 빨리 확인할 수 있지만, 데이터 복제를 위해 더 많은 대역폭 사용
   - 레디스는 지연 시간 최소화를 위해 기본값을 no로 설정 : 하지만, 대규모 트래픽 상황 또는 마스터와 복제본 간의 거리가 멀 경우에는 yes로 변경하는 것이 도움이 될 수 있음

7. 클라이언트 소켓에서 새로운 데이터가 도착하면 읽기 가능한 파일 이벤트를 생성
   - 레디스는 이를 이용해 클라이언트에서 전송한 쿼리를 수집하고 처리
   - 클라이언트가 초기화되면 레디스는 maxclients 설정값과 비교해 현재 클라이언트 수가 maxclients에 도달했는지 확인 : 이 값을 초과하면 새로운 클라이언트의 접속을 거부

8. 레디스 버전 2.6 이후 버전부터는 기본적으로 maxclients 수가 10000으로 설정되고, 설정 파일에서 별도로 변경하지 않는 한 이 값 유지
9. - 그러나 레디스가 시작될 때 운영체제의 설정값을 확인해 클라이언트 수를 제한할 수 있음
   - 레디스 서버 내부적으로 32개 파일 디스크럽터 수를 사용한다고 예약했으므로, 설정한 maxclients에 32를 더한 값보다 운영체제의 파일 디스크럽터 수가 작으면 maxclients 값은 운영체제에 맞게 변경되어 레디스 인스턴스가 시작
   
