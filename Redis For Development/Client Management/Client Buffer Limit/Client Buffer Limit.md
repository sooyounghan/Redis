-----
### 클라이언트 버퍼 제한
-----
1. 레디스는 클라이언트에 반환할 데이터를 임시로 저장하기 위해 각 클라이언트마다 클라이언트 출력 버퍼(Client Output Buffer)를 생성
   - 연결된 클라이언트가 1000개라면, 1000개의 출력 버퍼를 생성
   - 출력 버퍼는 레디스가 반환할 데이터 양에 따라 가변될 길이를 갖게 되지만, 만약 클라이언트가 데이터를 처리하지 못하고 계속해서 서버에 요청을 보내면 서버의 출력 버퍼 크기가 계속 증가하며, 이로 인해 메모리 사용량이 늘어남

2. 특히 pub / sub 클라이언트에서 발행자가 메세지를 발행하면, 해당 메세지는 모든 구독자에게 전달
   - 일반적으로 pub / sub 연결의 경우 발행자가 보낸 새로운 메세지를 구독자가 처리하지 속도가 충분하지 않은 상황이 발생하는 경우가 많음
   - 따라서, 레디스는 출력 버퍼 크기에 대한 제한을 둬서, 버퍼 크기가 일정 수준 이상으로 증가할 경우 클라이언트 연결을 종료하게 됨
   - 두 가지 종류의 제한 값 사용 가능
     + 하드 제한은 고정된 제한 값으로, 여기에 도달하면 레디스는 클라이언트 연결을 가능한 한 빨리 닫음
     + 소프트 제한은 시간에 따라 다르며, 이를테면 10초 동안 지속적으로 32MB보다 큰 출력 버퍼를 유지한 경우 연결을 닫음

3. 레디스에서는 일반 클라이언트와 pub / sub 클라이언트 그리고 복제본을 위한 출력 버퍼 크기가 모두 다르게 적용
   - 기본적으로 일반 클라이언트는 출력 버퍼 크기 제한이 0으로 설정
     + 하나의 커맨드를 보내고 다음 커맨드를 보내기 전 응답을 받기를 기다리고 있으므로, 연결을 닫아버리는 것은 예쌍치 못한 동작 방식일 수 있음

   - pub / sub 클라이언트의 경우 기본 하드 제한은 32MB이며, 소프트 제한은 60초당 8MB
     + 이는 pub / sub 클라이언트가 빠르게 처리되는 메세지들을 처리하기 위해 더 많은 메모리 공간이 필요하기 때문임

   - 복제본을 위한 출력 버퍼 크기 제한은 기본 하드 제한은 256MB, 소프트 제한은 60초당 64MB
     + 이는 복제본이 마스터 서버로부터 대량의 데이터를 받아들이는 경우가 많아, 더 큰 출력 버퍼가 필요하기 때문임
    
4. 이를 변경하기 위해 설정값을 변경하거나 CONFIG SET으로 변경할 수 있음
```redis
CONFIG SET client-output-buffer-limit <class> <hard-limit> <sort-limit> <soft-limit-duration>
```
   - ```<class>``` : normal, slave(replica), pubsub 중 하나
     + normal : 일반 레디스 클라이언트
     + slave와 replica : 레디스 복제본 클라이언트
     + pubsub : pub / sub 클라이언트를 나타냄

   - ```<hard-limit>, <sort-limit>``` : 각 하드 제한과 소프트 제한 값을 나타내며, 바이트 단위로 지정
   - ```<soft-limit-duration>``` : 소프트 제한이 적용되는 시간 간격으로, 초 단위

5. 예를 들어, 복제 클라이언트의 limit 값을 모두 제거하려면 다음과 같이 필요
```redis
> CONFIG SET client-output-buffer-limit "slave 0 0 0"
OK
```

6. 클라이언트 출력 버퍼 외에도 클라이언트 쿼리 버퍼라는 내부 버퍼도 존재
   - 클라이언트 출력 버퍼가 레디스 서버가 클라이언트에 응답을 보낼 때 사용하는 내부 버퍼라면, 클라이언트 쿼리 버퍼는 클라이언트에서 받은 컴내드를 레디스에서 잠시 보관하는 내부 버퍼 역할
   - 클라이언트가 레디스 서버에 커맨드를 전송하면 레디스 서버는 이를 쿼리 버퍼에 저장한 뒤 처리
   - 쿼리 버퍼의 크기는 기본적으로 1GB로 설정되었는데, 클라이언트에서 발생하는 버그로 인해 클라이언트 쿼리 버퍼가 무한히 증가하는 것을 방지하기 위한 조치
   - 그러나 특별 상황에서 이 제한을 조정해야 할 필요가 있는 경우, client-query-buffer-limit 설정을 변경해 이용할 수 있으며, 이를 통해 클라이언트 쿼리 버퍼 크기를 원하는 크기로 조절 가능
