-----
### 캐시에서의 데이터 흐름
-----
1. 기본적으로 캐시는 데이터 스토어가 갖고 있는 데이터 중 사용자가 자주 사용할만한 데이터를 갖고와서 임시로 저장하는 저장소
2. 따라서 데이터스토어보다 적은 양을 보관하는 데이터베이스의 서브셋이라고 볼 수 있음
   - 레디스는 특히 메모리에 모든 데이터를 저장하며, 기본적으로 메모리는 서버의 스토리지보다 훨씬 적은 양을 보관할 수 밖에 없음
<div align="center">
<img src="https://github.com/user-attachments/assets/27baa325-4084-4418-a1ec-ee343c282ca7">
</div>

   - 따라서, 캐시는 가득 차지 않게 일정 양의 데이터를 유지해야하며, 계속해서 새로운 데이터가 저장되고 기존 데이터는 삭제될 수 있도록 관리해야 함
   - 따라서, 캐시로 레디스를 사용할 때는 데이터를 저장함과 동시에 적절한 시간의 TTL값을 지정하는 것이 좋음

3. 만료 시간
   - 레디스에서 만료 시간, 즉 TTL(Time To Live)은 데이터가 얼마나 오래 저장될 것인지를 나타내는 시간 설정
   - 레디스는 데이터베이스 내 특정 키에 대한 만료 시간을 설정할 수 있으며, 이는 데이터 유효 기간 또는 만료 시간을 정의하는데 사용
   - 만료 시간은 일반적으로 초(Second) 단위로 표현되며, 특정 키에 대한 만료 시간이 설정되면, 해당 키와 관련된 데이터는 지정된 시간이 지난 후 레디스에서 자동으로 삭제
   - 이를 통해 레디스에서 임시 데이터를 처리하거나 캐시 데이터를 유지하고 관리할 수 있음
   - 키에 만료 시간을 설정하면, 데이터의 수명을 관리하고 메모리 공간을 효율적으로 사용하는데 도움을 줌
   - 레디스에 저장된 키에 EXPIRE 커맨드를 사용하면 만료 시간 지정 가능
     + SET 커맨드로 string 데이터를 저장할 때에는 EX 옵션을 함께 사용해 데이터의 저장과 동시에 만료 시간 설정 가능
     + TTL 커맨드를 사용하면 키에 대한 만료 시간을 확인할 수 있음 : 만료 시간이 남아있다면 남은 시간 반환, 키가 존재하지 않으면 -2, 키에 대해 만료 시간이 지정되지 않았을 경우에는 -1을 반환
     + TTL과 EXPIRE 커맨드는 초 단위로 동작하며, PTTL와 PEXPIRE 커맨드는 ms 단위로 동작

   - 예제
```redis
> SET a 100
OK

> EXPIRE a 60
(integer) 1

> TTL a
(integer) 57
```
   - a라는 키에 100을 저장한 뒤 EXPIRE 커맨드를 이용해 만료 시간을 60초로 설정
   - INCR 커맨드로 데이터를 조작하거나 RENAME를 이용해 키의 이름을 바꾸더라도 설정된 만료 시간은 변경되지 않음
```redis
> INCR a
(integer) 101

> TTL a
(integer) 53

> RENAME a apple
OK

> TTL apple
(integer) 46
```
   - 그러나 기존 키에 새로운 값을 저장해 키를 덮어쓸 때는 이전에 설정한 만료 시간은 유지되지 않고 사라짐
```redis
> SET b 100
OK

> EXPIRE b 60
(integer) 1

> TTL b
(integer) 58

> SET b banana
OK

> TTL b
(integer) -1
```

4. 레디스에서 키가 만료되었다고 하더라도 바로 메모리에서 삭제되는 것은 아님 : 키는 Passive 방식과 Active 방식 이 두가지로 삭제
   - Passive 방식 : 클라이언트가 키에 접근하고자할 때, 키가 만료되었다면 메모리에서 수동적으로 삭제
     + 사용자가 접근할 때에만 수동적으로 삭제되므로 이를 Passvie 방식의 만료라고 부름
     + 그러나 사용자가 다시 접근하지 않는 만료된 키도 있어, 이 방식만으로 충분하지 않음

   - Active 방식 : TTL 값이 있는 키 중 20개를 랜덤으로 뽑아낸 뒤, 만료된 키를 모두 메모리에서 삭제
     + 만약 25% 이상의 키가 삭제되었다면, 다시 20개의 키를 램덤하게 뽑은 뒤 확인
     + 아니라면, 20개의 키 집합에서 다시 확인
     + 이러한 과정을 1초에 10번씩 수행

   - 만료된 키를 곧바로 삭제하지 않기 때문에 키를 삭제하는 데 들어가는 리소스를 줄일 수 있지만, 그만큼 메모리를 더 사용할 가능성이 존재
   - 최악의 경우, 전체 메모리의 1/4는 이미 만료된 키 값 일 수 있음
