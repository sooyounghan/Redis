-----
### 부분 재동기화
-----
1. 복제 연결이 끊길 때마다 마스터에서 RDB 파일을 새로 내려 복제본에 전달하는 과정을 거친다면, 네트워크가 불완전한 상황에서 복제 기능을 사용하는 레디스의 성능은 급격하게 나빠질 것
   - 이를 방지하기 위해 레디스는 부분 재동기화(Partial Resynchronization) 기능을 사용해 안정적으로 복제 연결을 유지

2. 마스터는 커넥션 유실을 대비해 백로그 버퍼라는 메모리 공간에 복제본에 전달한 커맨드 데이터들을 저장
   - 하나의 복제 그룹에서 replication_id와 오프셋을 이용하면 복제본이 마스터의 어느 시점까지 데이터를 가지고 있는지 파악 가능
   - 만약, 복제 연결이 잠시 끊긴 뒤 재연결되면 복제본은 PSYNC 커맨드를 호출해 자신의 replication_id와 오프셋을 마스터에 전달
<div align="center">
<img src="https://github.com/user-attachments/assets/cf5d137c-0c59-4619-8f10-666c7bf726e5">
</div>

   - 오프셋 900의 복제본 노드가 마스터 노드에 재연결을 시도하는 모습
   - 만약 오프셋 901 ~ 915의 내용이 마스터의 백로그에 저장되어 있다면, RDB 파일을 새로 저장할 필요 없이 백로그에 저장된 내용을 복제본에 전달함으로써 부분 재동기화를 진행할 수 있음

3. 하지만 마스터의 백로그 버퍼에 원하는 데이터가 남아있지 않거나, 복제본이 보낸 Replication ID가 현재의 현재의 마스터와 일치하지 않으면 전체 재동기화(Full Resync)를 시도
4. 복제 백로그의 크기는 repl-backlog-size 파라미터로 설정할 수 있으며, 기본값은 1MB
   - 복제 연결이 끊겼을 때, 백로그 크기가 클수록 복제본이 부분 재동기화를 수행할 수 있는 시간이 길어짐
   - 백로그는 1개 이상의 복제본이 연결된 경우에만 할당되며, repl-backlog-ttl 만큼 시간이 경과하면 메모리에서 백로그 공간 삭제

5. 복제본은 언제든지 마스터로 승격될 가능성을 갖고 있으므로 복제본에 직접 연결된 복제 연결이 따로 없더라도 백로그 버퍼를 해제하지 않음
   - 추후 다른 복제본과 부분 재동기화를 시도할 때 사용
